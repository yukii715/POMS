package com.owsb.poms.ui.admin;

import com.owsb.poms.system.model.Item;
import java.util.List;
import javax.swing.JOptionPane;

public class NewItem extends javax.swing.JDialog {
    private String category;
    private String type;
    private String name;
    private double price = 0;
    
    private boolean validCategoryTypeName;
    private boolean validPrice;

    /**
     * Creates new form NewItem
     */
    public NewItem(java.awt.Frame parent, boolean modal) {
        super(parent, modal);
        initComponents();
        
        setTitle("New Item");
        txtCategory.setVisible(false);
        txtType.setVisible(false);
        var categories = Item.getAllCategories();
        for (String category : categories) {
            cmbCategory.addItem(category);
        }
    }
    
    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        pnlMain = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        cmbCategory = new javax.swing.JComboBox<>();
        jLabel3 = new javax.swing.JLabel();
        cmbType = new javax.swing.JComboBox<>();
        txtCategory = new javax.swing.JTextField();
        txtType = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        txtName = new javax.swing.JTextField();
        jLabel5 = new javax.swing.JLabel();
        txtPrice = new javax.swing.JTextField();
        jLabel6 = new javax.swing.JLabel();
        btnAdd = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);

        pnlMain.setBackground(new java.awt.Color(255, 255, 204));
        pnlMain.setMinimumSize(new java.awt.Dimension(396, 388));
        pnlMain.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jLabel2.setFont(new java.awt.Font("Berlin Sans FB", 0, 14)); // NOI18N
        jLabel2.setForeground(new java.awt.Color(0, 0, 0));
        jLabel2.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        jLabel2.setText("Category:");
        pnlMain.add(jLabel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(49, 34, -1, -1));

        cmbCategory.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "New" }));
        cmbCategory.setSelectedItem(null);
        cmbCategory.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmbCategoryActionPerformed(evt);
            }
        });
        pnlMain.add(cmbCategory, new org.netbeans.lib.awtextra.AbsoluteConstraints(157, 30, 193, -1));

        jLabel3.setFont(new java.awt.Font("Berlin Sans FB", 0, 14)); // NOI18N
        jLabel3.setForeground(new java.awt.Color(0, 0, 0));
        jLabel3.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        jLabel3.setText("Type:");
        pnlMain.add(jLabel3, new org.netbeans.lib.awtextra.AbsoluteConstraints(49, 89, 57, -1));

        cmbType.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "New" }));
        cmbType.setSelectedItem(null);
        cmbType.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cmbTypeActionPerformed(evt);
            }
        });
        pnlMain.add(cmbType, new org.netbeans.lib.awtextra.AbsoluteConstraints(157, 85, 193, -1));

        txtCategory.setFont(new java.awt.Font("Berlin Sans FB", 0, 14)); // NOI18N
        pnlMain.add(txtCategory, new org.netbeans.lib.awtextra.AbsoluteConstraints(157, 60, 193, -1));

        txtType.setFont(new java.awt.Font("Berlin Sans FB", 0, 14)); // NOI18N
        pnlMain.add(txtType, new org.netbeans.lib.awtextra.AbsoluteConstraints(157, 115, 193, -1));

        jLabel4.setFont(new java.awt.Font("Berlin Sans FB", 0, 14)); // NOI18N
        jLabel4.setForeground(new java.awt.Color(0, 0, 0));
        jLabel4.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        jLabel4.setText("Name:");
        pnlMain.add(jLabel4, new org.netbeans.lib.awtextra.AbsoluteConstraints(49, 147, 57, -1));

        txtName.setFont(new java.awt.Font("Berlin Sans FB", 0, 14)); // NOI18N
        pnlMain.add(txtName, new org.netbeans.lib.awtextra.AbsoluteConstraints(157, 146, 193, -1));

        jLabel5.setFont(new java.awt.Font("Berlin Sans FB", 0, 14)); // NOI18N
        jLabel5.setForeground(new java.awt.Color(0, 0, 0));
        jLabel5.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        jLabel5.setText("Price:");
        pnlMain.add(jLabel5, new org.netbeans.lib.awtextra.AbsoluteConstraints(49, 203, 57, -1));

        txtPrice.setFont(new java.awt.Font("Berlin Sans FB", 0, 14)); // NOI18N
        pnlMain.add(txtPrice, new org.netbeans.lib.awtextra.AbsoluteConstraints(194, 202, 156, -1));

        jLabel6.setFont(new java.awt.Font("Berlin Sans FB", 0, 14)); // NOI18N
        jLabel6.setForeground(new java.awt.Color(0, 0, 0));
        jLabel6.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        jLabel6.setText("RM");
        pnlMain.add(jLabel6, new org.netbeans.lib.awtextra.AbsoluteConstraints(157, 203, 25, -1));

        btnAdd.setBackground(new java.awt.Color(255, 153, 0));
        btnAdd.setFont(new java.awt.Font("Berlin Sans FB", 0, 14)); // NOI18N
        btnAdd.setForeground(new java.awt.Color(252, 251, 249));
        btnAdd.setText("Add");
        btnAdd.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnAddActionPerformed(evt);
            }
        });
        pnlMain.add(btnAdd, new org.netbeans.lib.awtextra.AbsoluteConstraints(136, 273, 111, 39));

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(pnlMain, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(pnlMain, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void cmbCategoryActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmbCategoryActionPerformed
        for (int i = cmbType.getItemCount() - 1; i >= 1; i--) {
            cmbType.removeItemAt(i);
        }
        if (cmbCategory.getSelectedIndex() == 0){
            txtCategory.setVisible(true);
        }
        else{
            txtCategory.setVisible(false);
            var types = Item.getAllTypes(cmbCategory.getSelectedItem().toString());
            for (String type : types) {
                cmbType.addItem(type);
            }
        }
    }//GEN-LAST:event_cmbCategoryActionPerformed

    private void cmbTypeActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cmbTypeActionPerformed
        if (cmbType.getSelectedIndex() == 0){
            txtType.setVisible(true);
        }
        else
        {
            txtType.setVisible(false);
        }
    }//GEN-LAST:event_cmbTypeActionPerformed

    private void btnAddActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnAddActionPerformed
        category = cmbCategory.getSelectedIndex() != 0 && cmbCategory.getSelectedItem() != null ? cmbCategory.getSelectedItem().toString() : txtCategory.getText().trim();
        type = cmbType.getSelectedIndex() != 0 && cmbType.getSelectedItem() != null ? cmbType.getSelectedItem().toString() : txtType.getText().trim();
        name = txtName.getText().trim();
        
        validCategoryTypeName = !(category == null || category.isBlank()|| type == null || type.isBlank() || name == null || name.isBlank());
        try{
            price = Double.parseDouble(txtPrice.getText().trim());
            if (price <= 0){
                validPrice = false;
            }
            else{
                validPrice = true;
            }
        } catch (NumberFormatException e){
            validPrice = false;
        }
        
        if (!validCategoryTypeName){
            JOptionPane.showMessageDialog(this, "Invalid Category, Type or Name", "Error", JOptionPane.ERROR_MESSAGE);
            return;
        }
        
        if (!validPrice){
            JOptionPane.showMessageDialog(this, "Invalid Price", "Error", JOptionPane.ERROR_MESSAGE);
            return;
        }
        
        int result = JOptionPane.showConfirmDialog(this, "Are you sure to add this new item?", "Add New Item", JOptionPane.YES_NO_OPTION, JOptionPane.QUESTION_MESSAGE);
        if (result == JOptionPane.YES_OPTION){
            Item item = new Item(category, type, name, price);
            item.add();
            JOptionPane.showMessageDialog(this, "Successfully added a new item!");
            this.dispose();
        }
    }//GEN-LAST:event_btnAddActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnAdd;
    private javax.swing.JComboBox<String> cmbCategory;
    private javax.swing.JComboBox<String> cmbType;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JPanel pnlMain;
    private javax.swing.JTextField txtCategory;
    private javax.swing.JTextField txtName;
    private javax.swing.JTextField txtPrice;
    private javax.swing.JTextField txtType;
    // End of variables declaration//GEN-END:variables
}
